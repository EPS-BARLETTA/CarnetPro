<!DOCTYPE html><html lang="fr"><head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>CarnetPro — Analyses</title>
<style>
:root{
  --ink:#0b1324;--muted:#475569;--border:#e5e7eb;--card:#ffffff;--blue:#2563eb;--green:#16a34a;--red:#dc2626;--amber:#f59e0b;
}
*{box-sizing:border-box}
html,body{margin:0;padding:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Helvetica,Arial,sans-serif;background:#f8fafc;color:var(--ink)}
.container{max-width:1100px;margin:0 auto;padding:16px}
.header{display:flex;align-items:center;justify-content:space-between;gap:12px;margin:8px 0 16px}
.h1{font-size:clamp(22px,4vw,30px);font-weight:800}
.sub{color:var(--muted)}
.grid{display:grid;gap:12px}
.tiles{grid-template-columns:repeat(auto-fit,minmax(210px,1fr))}
.tile{display:flex;flex-direction:column;gap:6px;padding:16px;border:1px solid var(--border);border-radius:16px;background:#fff;text-decoration:none;color:inherit}
.tile:hover{outline:2px solid #c7d2fe}
.tile .name{font-weight:800}
.row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
.card{background:var(--card);border:1px solid var(--border);border-radius:16px;padding:16px}
.button{appearance:none;border:1px solid var(--border);background:#fff;padding:12px 16px;border-radius:12px;cursor:pointer;font-weight:700;text-decoration:none;color:inherit}
.button.primary{background:var(--blue);border-color:var(--blue);color:#fff}
.button.ok{background:var(--green);border-color:var(--green);color:#fff}
.button.warn{background:var(--amber);border-color:var(--amber);color:#111}
.button.danger{background:var(--red);border-color:var(--red);color:#fff}
.input{width:100%;padding:12px 14px;border:1px solid var(--border);border-radius:12px}
textarea.input{min-height:96px}
.label{font-size:12px;color:var(--muted);margin-bottom:6px}
.footer{margin-top:18px;color:var(--muted);text-align:center}
hr{border:0;border-top:1px solid var(--border);margin:16px 0}
.badge{display:inline-flex;align-items:center;gap:6px;font-size:12px;border:1px solid var(--border);border-radius:999px;padding:6px 10px;background:#fff}
.calendar{display:grid;grid-template-columns:repeat(7,1fr);gap:8px}
.day{border:1px solid var(--border);background:#fff;border-radius:12px;min-height:90px;padding:6px}
.day .d{font-weight:700}
.badge-dot{display:inline-block;width:8px;height:8px;border-radius:50%;background:#2563eb}
.qr-wrap{display:flex;flex-direction:column;align-items:center;gap:12px}
.qr-box{padding:12px;border-radius:16px;border:1px dashed var(--border);background:#fff}
.contrast-dark .qr-box{filter:invert(1)}
</style></head><body>
<div class="container">
  <div class="header"><div class="h1">Analyses</div><a class="button" href="index.html">Accueil</a></div>
  <div class="card">
    <div class="row"><button id="refresh" class="button">Mettre à jour</button></div>
    <canvas id="chart1" width="900" height="380"></canvas>
  </div>
</div>
<script>

function gpGet(key, fallback=null){ try{ const v = localStorage.getItem(key); return v? JSON.parse(v): fallback; }catch(e){ return fallback; } }
function gpSet(key, value){ localStorage.setItem(key, JSON.stringify(value)); }
function gpRemove(key){ localStorage.removeItem(key); }
const GP_KEYS = { eleve:'eleve', seances:'seances', derniereSeance:'derniereSeance' };
function makeSeance(eleve, activite, champs={}, notes=''){
  return { app:'CarnetPro', version:'1.0', eleve, seance:{ date: champs.date || new Date().toISOString().slice(0,10), activite, champs, notes } };
}

const canvas=document.getElementById('chart1'); const ctx=canvas.getContext('2d');
function weeklyTotals(){ const data=gpGet(GP_KEYS.seances,[]); const map=new Map(); data.forEach(s=>{ if(s.seance?.activite!=='Course') return; const d=new Date(s.seance.date||new Date()); const first=new Date(d); first.setDate(d.getDate()-((d.getDay()+6)%7)); const key=first.toISOString().slice(0,10); const km=Number(s.seance?.champs?.distance_km||0); map.set(key,(map.get(key)||0)+km); }); const entries=[...map.entries()].sort((a,b)=>a[0].localeCompare(b[0])); return {labels:entries.map(e=>e[0]), values:entries.map(e=>e[1])}; }
function draw(){ const {labels,values}=weeklyTotals(); ctx.clearRect(0,0,canvas.width,canvas.height); const padding=50; const w=canvas.width,h=canvas.height; const plotW=w-padding*2, plotH=h-padding*2; ctx.strokeStyle='#000'; ctx.beginPath(); ctx.moveTo(padding,padding); ctx.lineTo(padding,h-padding); ctx.lineTo(w-padding,h-padding); ctx.stroke(); const maxV=Math.max(5, Math.max(...values,0)); const bw= values.length? plotW/values.length*0.6 : 40; ctx.fillStyle='#2563eb'; values.forEach((v,i)=>{ const x=padding+(plotW/(values.length||1))*i+(plotW/(values.length||1)-bw)/2; const y=h-padding-(v/maxV)*plotH; ctx.fillRect(x,y,bw,(v/maxV)*plotH); }); ctx.font='12px system-ui'; ctx.textAlign='center'; ctx.fillStyle='#0b1324'; labels.forEach((lab,i)=>{ const x=padding+(plotW/(labels.length||1))*i+(plotW/(labels.length||1))/2; ctx.fillText(lab.slice(5),x,h-padding+14); }); ctx.textAlign='right'; ctx.fillText('km/sem', padding-6, padding-6); }
document.getElementById('refresh').addEventListener('click', draw);
draw();
</script>
</body></html>
